<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:FyreWorksPM.Common.Converters;assembly=FyreWorksPM"
    xmlns:controls="clr-namespace:FyreWorksPM.Controls"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:FyreWorksPM.ViewModels.Creation"
    x:Class="FyreWorksPM.Pages.Creation.CreateBidPage"
    x:Name="CreateBid"
    Title="New Bid">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:DecimalConverter x:Key="DecimalConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>


    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- ============================= -->
            <!--        BID INFORMATION        -->
            <!-- ============================= -->
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="10">

                    <Grid ColumnDefinitions="3*,Auto" ColumnSpacing="10">
                    <Label Grid.Column="0" 
                           Text="Bid Information" 
                           TextDecorations="Underline"
                           FontSize="18"
                           FontAttributes="Bold,Italic"
                           TextColor="White" />
                        
                    <HorizontalStackLayout Grid.Column="1"  Spacing="10" VerticalOptions="Center">
                        <CheckBox IsChecked="{Binding IsActive, Mode=TwoWay}" />
                        <Label Text="Bid Active" VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    </Grid>

                    <!-- Bid Number -->                    
                    <Entry  
                        x:DataType="vm:CreateBidViewModel"
                        Text="{Binding BidNumber}" 
                        Placeholder="Bid Number (e.g. B-001)" 
                        IsReadOnly="True" 
                        BackgroundColor="Black"
                        TextColor="White"/>
                    
                    <!-- Project Name -->
                    <Entry
                        Placeholder="Project Name"
                        Text="{Binding ProjectName, Mode=TwoWay}" />

                    <!-- Client Picker + Add Client Button -->
                    <Grid ColumnDefinitions="3*,Auto" ColumnSpacing="10">

                        <!-- 🔥 Correct: Picker for Clients -->
                        <Picker Grid.Column="0"
                                Title="Select Client"
                                ItemsSource="{Binding Clients}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedClient, Mode=TwoWay}" />

                        <Button Grid.Column="1"
                                Text="➕ New Client" 
                                Command="{Binding AddNewClientCommand}"
                                BackgroundColor="MediumPurple"
                                TextColor="White" />
                    </Grid>

                    <!-- Created Date -->
                    <DatePicker Date="{Binding CreatedDate}" />

                    <Button 
                            Text="Save Bid"
                            Command="{Binding SaveBidCommand}"
                            BackgroundColor="#8e6dc0"
                            TextColor="White"
                            Margin="10,20"
                            CornerRadius="8"
                            FontAttributes="Bold"/>


                </VerticalStackLayout>
            </Border>

            <!-- ============================= -->
            <!--       TOTALS OVERVIEW         -->
            <!-- ============================= -->
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Totals Overview"
                           TextDecorations="Underline"
                           FontAttributes="Bold,Italic"
                           FontSize="18"
                           TextColor="White" />

                    <!-- Side-by-side Totals -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="30">
                        <!-- === Bid Calculated Totals === -->
                        <VerticalStackLayout Grid.Column="0" Spacing="6">
                            <Label Text="Bid Calculated Totals and Sale Price" FontAttributes="Bold" FontSize="18" TextColor="White" />
                            <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="4">
                                <Label Text="Cost Total:" Grid.Row="0" Grid.Column="0"/>
                                <Label Text="{Binding CalculatedCostTotal, StringFormat='    ${0:F2}'}" Grid.Row="0" Grid.Column="1" />

                                <Label Text="Sale Total:" Grid.Row="1" Grid.Column="0" />
                                <Label Text="{Binding CalculatedSaleTotal, StringFormat='    ${0:F2}'}" Grid.Row="1" Grid.Column="1" />

                                <Label Text="Profit:" Grid.Row="2" Grid.Column="0" />
                                <Label Text="{Binding CalculatedProfit, StringFormat='    ${0:F2}'}" Grid.Row="2" Grid.Column="1" />

                                <Label Text="Margin:" Grid.Row="3" Grid.Column="0" />
                                <Label Text="{Binding CalculatedMargin, StringFormat='    {0:P2}'}" Grid.Row="3" Grid.Column="1"  />
                                <Label Grid.Row="5"/>
                                <Label Grid.Row="6"/>
                            </Grid>
                            <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto,Auto,Auto,*,Auto" ColumnSpacing="10" RowSpacing="8">

                                <Label Text="Regular Hours" FontAttributes="Bold" TextDecorations="Underline" Grid.Column="1" Grid.Row="0" />
                                <Label Text="Overnight Hours" FontAttributes="Bold" TextDecorations="Underline" Grid.Column="2" Grid.Row="0" />
                                <Label Text="Journeyman:" Grid.Column="0" Grid.Row="2" />
                                <Label Text="Apprentice:" Grid.Column="0" Grid.Row="3" />
                                <Label Text="{Binding JourneymanRegularHoursTotal}" Grid.Column="1" Grid.Row="2" />
                                <Label Text="{Binding ApprenticeRegularHoursTotal}" Grid.Column="1" Grid.Row="3" />
                                <Label Text="{Binding JourneymanOvernightHoursTotal}" Grid.Column="2" Grid.Row="2" />
                                <Label Text="{Binding ApprenticeOvernightHoursTotal}" Grid.Column="2" Grid.Row="3" />
                                <Label Text="Total Hours:" FontAttributes="Bold" Grid.Column="0" Grid.Row="5" />
                                <Label Text="{Binding TotalRegularHours, StringFormat='{0:F2}'}" FontAttributes="Bold" Grid.Column="1" Grid.Row="5" />
                                <Label Text="{Binding TotalOvernightHours, StringFormat='{0:F2}'}" FontAttributes="Bold" Grid.Column="2" Grid.Row="5"/>
                                <BoxView Grid.Row="4"
                                         Grid.ColumnSpan="5"
                                         HeightRequest="1"
                                         BackgroundColor="Gray"
                                         HorizontalOptions="Fill" />
                            </Grid>                            
                        </VerticalStackLayout>

                        <!-- === Adjusted Totals === -->
                        <VerticalStackLayout Grid.Column="1" Spacing="6">
                            <Label Text="Bid Calculated Totals and Adjusted Sale" FontAttributes="Bold" FontSize="18" TextColor="White" />
                            <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="4">
                                <Label Text="Cost Total:" />
                                <Label Text="{Binding CalculatedCostTotal, StringFormat='   ${0:F2}'}" Grid.Column="1" />

                                <Label Text="Adjusted Sale Total:" Grid.Row="1" VerticalTextAlignment="Center"/>
                                <Entry Text="{Binding AdjustedSaleTotal}" Grid.Row="1" Grid.Column="1" Keyboard="Numeric" />

                                <Label Text="Profit:" Grid.Row="2" />
                                <Label Text="{Binding AdjustedProfit, StringFormat='   ${0:F2}'}" Grid.Row="2" Grid.Column="1" />

                                <Label Text="Margin:" Grid.Row="3" />
                                <Label Text="{Binding AdjustedMargin, StringFormat='   {0:P2}'}" Grid.Row="3" Grid.Column="1" />
                            </Grid>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- ============================= -->
            <!--           SITE INFO           -->
            <!-- ============================= -->
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="10">
                    <!-- Header -->
                    <Label Text="Site Info"
                           TextDecorations="Underline"
                           FontSize="18"
                           FontAttributes="Bold,Italic"
                           TextColor="White" />

                    <!-- Structured two-column layout for labels + inputs -->
                    <Grid ColumnDefinitions="160,*"
                          RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                          RowSpacing="6">

                        <!-- Row 0: Scope of Work with Editor -->
                        <Label Grid.Row="0" Grid.Column="0" Text="Scope of Work" VerticalOptions="Start" />
                        <Editor Grid.Row="0" Grid.Column="1" Text="{Binding ScopeOfWork}" AutoSize="TextChanges" HeightRequest="80" />

                        <!-- Rows 1-13: Address / Site fields -->
                        <Label Grid.Row="1" Grid.Column="0" Text="Address Line 1" />
                        <Entry Grid.Row="1" Grid.Column="1" Text="{Binding AddressLine1}" />

                        <Label Grid.Row="2" Grid.Column="0" Text="Address Line 2" />
                        <Entry Grid.Row="2" Grid.Column="1" Text="{Binding AddressLine2}" />

                        <Label Grid.Row="3" Grid.Column="0" Text="City" />
                        <Entry Grid.Row="3" Grid.Column="1" Text="{Binding City}" />

                        <Label Grid.Row="4" Grid.Column="0" Text="State" />
                        <Entry Grid.Row="4" Grid.Column="1" Text="{Binding State}" />

                        <Label Grid.Row="5" Grid.Column="0" Text="Zip Code" />
                        <Entry Grid.Row="5" Grid.Column="1" Text="{Binding ZipCode}" />

                        <Label Grid.Row="6" Grid.Column="0" Text="Parcel Number" />
                        <Entry Grid.Row="6" Grid.Column="1" Text="{Binding ParcelNumber}" />

                        <Label Grid.Row="7" Grid.Column="0" Text="Jurisdiction" />
                        <Entry Grid.Row="7" Grid.Column="1" Text="{Binding Jurisdiction}" />

                        <Label Grid.Row="8" Grid.Column="0" Text="Building Area (ft²)" />
                        <Entry Grid.Row="8" Grid.Column="1" Text="{Binding BuildingArea}" Keyboard="Numeric" />

                        <Label Grid.Row="9" Grid.Column="0" Text="Number of Stories" />
                        <Entry Grid.Row="9" Grid.Column="1" Text="{Binding NumberOfStories}" Keyboard="Numeric" />

                        <Label Grid.Row="10" Grid.Column="0" Text="Occupancy Group" />
                        <Entry Grid.Row="10" Grid.Column="1" Text="{Binding OccupancyGroup}" />

                        <Label Grid.Row="11" Grid.Column="0" Text="Occupant Load" />
                        <Entry Grid.Row="11" Grid.Column="1" Text="{Binding OccupantLoad}" Keyboard="Numeric" />

                        <Label Grid.Row="12" Grid.Column="0" Text="Construction Type" />
                        <Entry Grid.Row="12" Grid.Column="1" Text="{Binding ConstructionType}" />

                        <Label Grid.Row="13" Grid.Column="0" Text="Sprinklered (Yes/No)" />
                        <Picker Grid.Row="13" Grid.Column="1"                                
                                ItemsSource="{Binding YesNoOptions}"
                                SelectedItem="{Binding SelectedSprinklerOption}" />

                        <!--<Entry Grid.Row="13" Grid.Column="1" Text="{Binding IsSprinklered}" />-->
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- ============================= -->
            <!--     ADMIN / ENGINEERING      -->
            <!-- ============================= -->
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="15">
                    <!-- Header -->
                    <Label Text="Admin / Engineering Tasks"
                           TextDecorations="Underline"
                           FontAttributes="Bold,Italic"
                           FontSize="18"
                           TextColor="White" />

                    <!-- ===== ADMIN TASKS ===== -->

                    <VerticalStackLayout Padding="10" Spacing="10">
                        <Label Text="Administration Task List"
                               FontSize="Micro"
                               TextDecorations="Underline"
                               FontAttributes="Bold"               
                               TextColor="White"               
                               Margin="0,20,0,0" />

                        <!-- Add Task Button -->
                        <Button 
                            Text="Create New Task"
                            Command="{Binding NavigateToCreateTasksCommand}"
                            BackgroundColor="Purple"
                            TextColor="White"
                            Margin="10"
                            HorizontalOptions="Center" />



                        <Button Text="Add Task" Command="{Binding AddAdminTaskCommand}" />
                        
                        <!-- Task List -->
                        
                        <CollectionView ItemsSource="{Binding AdminTasks}">
                            <CollectionView.Header>
                                <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5,0" ColumnSpacing="10">
                                    <Label Grid.Column="0" Text="Task" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center"/>
                                    <Label Grid.Column="1" Text="Cost" TextColor="Red" FontAttributes="Bold" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
                                    <Label Grid.Column="2" Text="Sale" TextColor="Orange" FontAttributes="Bold" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
                                    <Button Grid.Column="3" WidthRequest="40" Text="❌" TextColor="Red" BackgroundColor="Transparent" FontAttributes="Bold" HorizontalOptions="Center"/>
                                </Grid>
                            </CollectionView.Header>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5" ColumnSpacing="10">
                                        <!-- Task -->
                                        <controls:SearchableEntryView
                                            Suggestions="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AllAdminTaskNames}"
                                            SearchText="{Binding Name, Mode=TwoWay}"
                                            SelectedItem="{Binding SelectedTemplateTaskName, Mode=TwoWay}"
                                            DisplayMemberPath="TaskName" />

                                        <!-- Cost -->
                                        <Grid Grid.Column="1" ColumnDefinitions="Auto,*" VerticalOptions="Center">
                                            <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                            <Entry Text="{Binding Cost, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" Keyboard="Numeric" Placeholder="0.00"
                                                   BackgroundColor="Transparent"
                                                   TextColor="White"
                                                   PlaceholderColor="White"/>
                                        </Grid>

                                        <!-- Sale -->
                                        <Grid Grid.Column="2" ColumnDefinitions="Auto,*" VerticalOptions="Center">
                                            <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                            <Entry Text="{Binding Sale, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" Keyboard="Numeric" Placeholder="0.00"
                                                    BackgroundColor="Transparent"
                                                    TextColor="White"
                                                    PlaceholderColor="White"/>
                                        </Grid>

                                        <!-- Delete -->
                                        <Button Grid.Column="3"
                                                Text="❌"
                                                Command="{Binding BindingContext.RemoveAdminTaskCommand, Source={x:Reference CreateBid}}"
                                                CommandParameter="{Binding .}"
                                                WidthRequest="40"
                                                HeightRequest="40"
                                                BackgroundColor="SlateBlue"
                                                CornerRadius="8"
                                                Padding="0"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>


                        <!-- Totals -->
                        <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5" ColumnSpacing="10">
                            <!-- Empty cell for Task column -->
                            <Label Grid.Column="0" Text="Administration Totals:"/>

                            <!-- Cost total -->
                            <Label Grid.Column="1"
                                   Text="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AdminCostTotal, StringFormat='${0:F2}'}"
                                   TextColor="Red"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Start" />

                            <!-- Sale total -->
                            <Label Grid.Column="2"
                                   Text="{Binding AdminSaleTotal, StringFormat='${0:F2}'}"
                                   TextColor="Orange"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Start" />

                            <!-- Optional: Empty delete column -->
                            <Button Grid.Column="3" WidthRequest="40" Text="" BackgroundColor="Transparent" />
                        </Grid>

                    </VerticalStackLayout>



                    <!-- ===== ENGINEERING TASKS ===== -->
                    <VerticalStackLayout Padding="10" Spacing="10">
                        <Label Text="Engineering Task List"
                               FontSize="Micro"
                               TextDecorations="Underline"
                               FontAttributes="Bold"
                               TextColor="White"
                               Margin="0,0,0,0" />

                        <!-- Add Task Button -->

                        <Button Text="Add Task" Command="{Binding AddEngineeringTaskCommand}" />

                        <!-- Task List -->

                        <CollectionView ItemsSource="{Binding EngineeringTasks}">
                            <CollectionView.Header>
                                <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5,0" ColumnSpacing="10">
                                    <Label Grid.Column="0" Text="Task" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center"/>
                                    <Label Grid.Column="1" Text="Cost" TextColor="Red" FontAttributes="Bold" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
                                    <Label Grid.Column="2" Text="Sale" TextColor="Orange" FontAttributes="Bold" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
                                    <Button Grid.Column="3" WidthRequest="40" Text="❌" TextColor="Red" BackgroundColor="Transparent" FontAttributes="Bold" HorizontalOptions="Center"/>
                                </Grid>
                            </CollectionView.Header>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5" ColumnSpacing="10">
                                        <!-- Task -->
                                        <controls:SearchableEntryView
                                            Suggestions="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AllEngineeringTaskNames}"
                                            SearchText="{Binding Name, Mode=TwoWay}"
                                            SelectedItem="{Binding SelectedTemplateTaskName, Mode=TwoWay}"
                                            DisplayMemberPath="TaskName" />

                                        <!-- Cost -->
                                        <Grid Grid.Column="1" ColumnDefinitions="Auto,*" VerticalOptions="Center">
                                            <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                            <Entry Text="{Binding Cost, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" Keyboard="Numeric" Placeholder="0.00"
                                                   BackgroundColor="Transparent"
                                                   TextColor="White"
                                                   PlaceholderColor="White"/>
                                        </Grid>

                                        <!-- Sale -->
                                        <Grid Grid.Column="2" ColumnDefinitions="Auto,*" VerticalOptions="Center">
                                            <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                            <Entry Text="{Binding Sale, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" Keyboard="Numeric" Placeholder="0.00"
                                                   BackgroundColor="Transparent"
                                                   TextColor="White"
                                                   PlaceholderColor="White"/>
                                        </Grid>

                                        <!-- Delete -->
                                        <Button Grid.Column="3"
                                                Text="❌"
                                                Command="{Binding BindingContext.RemoveEngineeringTaskCommand, Source={x:Reference CreateBid}}"
                                                CommandParameter="{Binding .}"
                                                WidthRequest="40"
                                                HeightRequest="40"
                                                BackgroundColor="SlateBlue"
                                                CornerRadius="8"
                                                Padding="0"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>


                        <!-- Totals -->
                        <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5" ColumnSpacing="10">
                            <!-- Empty cell for Task column -->
                            <Label Grid.Column="0" Text="Engineering Totals:"/>

                            <!-- Cost total -->
                            <Label Grid.Column="1"
                                   Text="{Binding EngineeringCostTotal, StringFormat='${0:F2}'}"
                                   TextColor="Red" 
                                   HorizontalTextAlignment="Start" />

                            <!-- Sale total -->
                            <Label Grid.Column="2"
                                   Text="{Binding EngineeringSaleTotal, StringFormat='${0:F2}'}"
                                   TextColor="Orange"
                                   HorizontalTextAlignment="Start" />

                            <!-- Optional: Empty delete column -->
                            <Button Grid.Column="3" WidthRequest="40" Text="" BackgroundColor="Transparent" />
                        </Grid>
                        <!-- Combined Admin + Engineering Total -->
                        <Grid ColumnDefinitions="7*,1.5*,1.5*,Auto" Padding="5" ColumnSpacing="10">
                            <!-- Empty cell for Task column -->
                            <Label Grid.Column="0" Text="Admin and Engineering Totals:" FontSize="Micro"
                                   TextDecorations="Underline"
                                   FontAttributes="Bold"      
                                   TextColor="White" 
                                   Margin="0,0,0,0"/>

                            <!-- Cost total -->
                            <Label Grid.Column="1"
                                   Text="{Binding AdminEngCostTotal, StringFormat='${0:F2}'}"
                                   TextColor="Red"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Start" />
                            
                            <!-- Sale total -->
                            <Label Grid.Column="2"
                                   Text="{Binding AdminEngSaleTotal, StringFormat='${0:F2}'}"
                                   TextColor="Orange"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Start" />

                            <!-- Optional: Empty delete column -->
                            <Button Grid.Column="3" WidthRequest="40" Text="" BackgroundColor="Transparent" />
                        </Grid>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- ============================= -->
            <!--     LABOR HOUR CALCULATOR     -->
            <!-- ============================= -->

            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="15">

                    <!-- Header -->
                    <Label Text="Labor Calculator"
               TextDecorations="Underline"
               FontAttributes="Bold,Italic"
               FontSize="18"
               TextColor="White" />

                    <!-- ===== Labor Hour Calculator ===== -->
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <Grid Padding="10" RowSpacing="5" ColumnSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Column Headers -->
                            <Label Grid.Row="0" Grid.Column="0" Text="Location" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="1" Text="Normal" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="2" Text="Lift" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="3" Text="Panel" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="4" Text="Pipe" FontAttributes="Bold"/>

                            <!-- Data Rows -->
                            <CollectionView Grid.Row="1" Grid.ColumnSpan="5"
                                ItemsSource="{Binding LaborHourMatrix}"
                                SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnSpacing="5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="2*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <Label Grid.Column="0"
                                                   Text="{Binding LocationName}" 
                                                   VerticalTextAlignment="Center"/>

                                            <Entry Grid.Column="1" Text="{Binding NormalHours, Mode=TwoWay}" Keyboard="Numeric"/>
                                            <Entry Grid.Column="2" Text="{Binding LiftHours, Mode=TwoWay}" Keyboard="Numeric"/>
                                            <Entry Grid.Column="3" Text="{Binding PanelHours, Mode=TwoWay}" Keyboard="Numeric"/>
                                            <Entry Grid.Column="4" Text="{Binding PipeHours, Mode=TwoWay}" Keyboard="Numeric"/>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </Border>

                    <!-- ============================= -->
                    <!--     Labor Rates    -->
                    <!-- ============================= -->
                    
                    <!-- Header -->
                    <Label Text="Labor Rates"
                           TextDecorations="Underline"
                           FontAttributes="Bold,Italic"
                           FontSize="18"
                           TextColor="White" />

                    <!-- ===== Device & Hour Totals ===== -->
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Rates" FontAttributes="Bold" TextColor="White" />
                            <Grid ColumnDefinitions="2*,*,*,*,*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="8">
                                <!--<Label Text="Role" FontAttributes="Bold" Grid.Row="0" Grid.Column="0" />-->
                                <Label Text="Regular Direct Rate" FontAttributes="Bold" Grid.Row="0" Grid.Column="1" />
                                <Label Text="Regular Billed Rate" FontAttributes="Bold" Grid.Row="0" Grid.Column="2" />
                                <Label Text="Overnight Direct Rate" FontAttributes="Bold" Grid.Row="0" Grid.Column="3" />
                                <Label Text="Overnight Billed Rate" FontAttributes="Bold" Grid.Row="0" Grid.Column="4" />

                                <!-- Journeyman -->
                                <Label Text="Journeyman" Grid.Row="1" Grid.Column="0" />
                                <Entry Text="{Binding JourneymanRegularDirectRate, StringFormat='{}{0:N2}'}" Placeholder="$65.00" Grid.Row="1" Grid.Column="1" />
                                <Entry Text="{Binding JourneymanRegularBilledRate, StringFormat='{}{0:N2}'}" Placeholder="$90.00" Grid.Row="1" Grid.Column="2" />
                                <Entry Text="{Binding JourneymanOvernightDirectRate, StringFormat='{}{0:N2}'}" Placeholder="$75.00" Grid.Row="1" Grid.Column="3" />
                                <Entry Text="{Binding JourneymanOvernightBilledRate, StringFormat='{}{0:N2}'}" Placeholder="$115" Grid.Row="1" Grid.Column="4" />

                                <!-- Apprentice -->
                                <Label Text="Apprentice" Grid.Row="2" Grid.Column="0" />
                                <Entry Text="{Binding ApprenticeRegularDirectRate, StringFormat='{}{0:N2}'}" Placeholder="$30.00" Grid.Row="2" Grid.Column="1" />
                                <Entry Text="{Binding ApprenticeRegularBilledRate, StringFormat='{}{0:N2}'}" Placeholder="$54.00" Grid.Row="2" Grid.Column="2" />
                                <Entry Text="{Binding ApprenticeOvernightDirectRate, StringFormat='{}{0:N2}'}" Placeholder="$45.00" Grid.Row="2" Grid.Column="3" />
                                <Entry Text="{Binding ApprenticeOvernightBilledRate, StringFormat='{}{0:N2}'}" Placeholder="$83.00" Grid.Row="2" Grid.Column="4" />
                            </Grid>
                        </VerticalStackLayout>


                        
            </Border>


            <!-- ============================= -->
            <!--         Devices and hours Total        -->
            <!-- ============================= -->
                    <Label Text="Devices + Hours Total"
       FontAttributes="Bold,Italic"
       TextDecorations="Underline"
       FontSize="18"
       TextColor="White" />
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="20">
                    <!-- Header -->
                    

                    <!-- 🔧 Repeatable Labor Group Template -->
                    <!-- === PREWIRE === -->
                   
                                <VerticalStackLayout Spacing="10">
                                    <Grid  Padding="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Label Grid.Column="0" Text="" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="1" Text="Normal" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="2" Text="Lift" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="3" Text="Panel" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="4" Text="Pipe" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="5" Text="Hours" FontAttributes="Bold" TextDecorations="Underline"/>
                                        <Label Grid.Column="6" Text="Totals" FontAttributes="Bold" TextDecorations="Underline" HorizontalTextAlignment="End"/>
                                    </Grid>
                                    <!-- === DEMO === -->
                                    <Grid ColumnDefinitions="*,*">
                                        <Label Grid.Column="0" Text="Demo" FontSize="16" FontAttributes="Bold" TextDecorations="Underline" TextColor="White" />
                                        <Label Grid.Column="1" Grid.Row="0" Text="{Binding DemoSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="End" />
                                    </Grid>
                                    <Grid Padding="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="2*" />
                                        </Grid.ColumnDefinitions>

                                        <Label Grid.Column="0" Text="{Binding DemoSummaryRow.Location}" FontAttributes="Bold"/>
                                        <Label Grid.Column="1" Text="{Binding DemoSummaryRow.NormalCount}" />
                                        <Label Grid.Column="2" Text="{Binding DemoSummaryRow.LiftCount}" />
                                        <Label Grid.Column="3" Text="{Binding DemoSummaryRow.PanelCount}" />
                                        <Label Grid.Column="4" Text="{Binding DemoSummaryRow.PipeCount}" />
                                        <Label Grid.Column="5" Text="{Binding DemoSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" />
                                    </Grid>

                                    <BoxView HeightRequest="1" Color="Gray" Margin="0,5" />

                                    <!-- === PREWIRE === -->
                                    <Grid>
                                        <Label Text="Prewire" FontSize="16" FontAttributes="Bold" TextDecorations="Underline" TextColor="White" />
                                        <Label Grid.Column="0" Grid.Row="0" Text="{Binding PrewireTotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="End" />
                                    </Grid>

                                    <CollectionView ItemsSource="{Binding PrewireDeviceHours}" SelectionMode="None">


                                        <CollectionView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Padding="5" ColumnSpacing="10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="2*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="2*" />
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Column="0" Text="{Binding Location}" />
                                                    <Label Grid.Column="1" Text="{Binding NormalCount}" />
                                                    <Label Grid.Column="2" Text="{Binding LiftCount}" />
                                                    <Label Grid.Column="3" Text="{Binding PanelCount}" />
                                                    <Label Grid.Column="4" Text="{Binding PipeCount}" />
                                                    <Label Grid.Column="5" Text="{Binding TotalHours, StringFormat='{}{0:N2}'}" />
                                                </Grid>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>

                                    <BoxView HeightRequest="1" Color="Gray" Margin="0,5" />

                                    <!-- === TRIM === -->
                                    <Grid>
                                        <Label Text="Trim" FontSize="16" FontAttributes="Bold" TextDecorations="Underline" TextColor="White" />
                                        <Label Grid.Column="1" Grid.Row="2" Text="{Binding TrimSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="End" />
                                    </Grid>
                                    <Grid Padding="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="2*" />
                                        </Grid.ColumnDefinitions>

                                        <Label Grid.Column="0" Text="{Binding TrimSummaryRow.Location}" FontAttributes="Bold"/>
                                        <Label Grid.Column="1" Text="{Binding TrimSummaryRow.NormalCount}" />
                                        <Label Grid.Column="2" Text="{Binding TrimSummaryRow.LiftCount}" />
                                        <Label Grid.Column="3" Text="{Binding TrimSummaryRow.PanelCount}" />
                                        <Label Grid.Column="4" Text="{Binding TrimSummaryRow.PipeCount}" />
                                        <Label Grid.Column="5" Text="{Binding TrimSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" />
                                    </Grid>

                                    <!-- === TOTALS COLUMN === -->
                                    <Grid Padding="5" ColumnSpacing="10" Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="6*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Label Grid.Column="0" Grid.Row="0" Text="Demo Total" FontAttributes="Bold" />
                                        <Label Grid.Column="1" Grid.Row="0" Text="{Binding DemoSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="Start" />

                                        <Label Grid.Column="0" Grid.Row="1" Text="Prewire Total" FontAttributes="Bold" />
                                        <Label Grid.Column="1" Grid.Row="1" Text="{Binding PrewireTotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="Start" />

                                        <Label Grid.Column="0" Grid.Row="2" Text="Trim Total" FontAttributes="Bold" />
                                        <Label Grid.Column="1" Grid.Row="2" Text="{Binding TrimSummaryRow.TotalHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="Start" />

                                        <Label Grid.Column="0" Grid.Row="3" Text="Grand Total" FontAttributes="Bold" />
                                        <Label Grid.Column="1" Grid.Row="3" Text="{Binding TotalCombinedHours, StringFormat='{}{0:N2}'}" HorizontalTextAlignment="Start" />
                                    </Grid>
                                </VerticalStackLayout>
                            
                        </VerticalStackLayout>
                    </Border>

                    <!-- === Hours === -->
                    <Label Text="Hours"
       FontAttributes="Bold,Italic"
       TextDecorations="Underline"
       FontSize="18"
       TextColor="White" />
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <VerticalStackLayout Spacing="10">
                            
                            
                            <Grid ColumnDefinitions="2*,*,*,*,*,*,*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="8">
                                <!--<Label Text="Role" FontAttributes="Bold" Grid.Row="0" Grid.Column="0" />-->
                                <Label Text="Demo" FontAttributes="Bold" Grid.Row="0" Grid.Column="1" />
                                <Label Text="Pre-Wire" FontAttributes="Bold" Grid.Row="0" Grid.Column="2" />
                                <Label Text="Trim" FontAttributes="Bold" Grid.Row="0" Grid.Column="3" />
                                <Label Text="Test" FontAttributes="Bold" Grid.Row="0" Grid.Column="4" />
                                <Label Text="Overnight Pre-Wire" FontAttributes="Bold" Grid.Row="0" Grid.Column="5" />
                                <Label Text="Overnight Trim" FontAttributes="Bold" Grid.Row="0" Grid.Column="6" />
                                <Label Text="Overnight Test" FontAttributes="Bold" Grid.Row="0" Grid.Column="7" />

                                <!-- Journeyman Hours -->
                                <Label Text="Journeyman" Grid.Row="1" Grid.Column="0" />
                                <Entry Text="{Binding DemoJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="1" />
                                <Entry Text="{Binding PrewireJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="2" />
                                <Entry Text="{Binding TrimJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="3" />
                                <Entry Text="{Binding TestJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="4" />
                                <Entry Text="{Binding OvernightPrewireJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="5" />
                                <Entry Text="{Binding OvernightTrimJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="6" />
                                <Entry Text="{Binding OvernightTestJourneymanHours}" Placeholder="0" Grid.Row="1" Grid.Column="7" />
                                


                                <!-- Apprentice Hours -->
                                <Label Text="Apprentice" Grid.Row="2" Grid.Column="0" />
                                <Entry Text="{Binding DemoApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="1" />
                                <Entry Text="{Binding PrewireApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="2" />
                                <Entry Text="{Binding TrimApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="3" />
                                <Entry Text="{Binding TestApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="4" />
                                <Entry Text="{Binding OvernightPrewireApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="5" />
                                <Entry Text="{Binding OvernightTrimApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="6" />
                                <Entry Text="{Binding OvernightTestApprenticeHours}" Placeholder="0" Grid.Row="2" Grid.Column="7" />

                            </Grid>


                        </VerticalStackLayout>
                    </Border>

                    <!-- 💰 Grand Labor Totals -->
                    <!-- Total Hours -->
                    <Label Text="Total Hours"
                           FontAttributes="Bold,Italic"
                           TextDecorations="Underline"
                           FontSize="18"
                           TextColor="White" />
                    
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto,Auto,Auto,*,Auto" ColumnSpacing="10" RowSpacing="8">
                            
                            <Label Text="Regular Hours" FontAttributes="Bold" TextDecorations="Underline" Grid.Column="1" Grid.Row="0" />
                            <Label Text="Overnight Hours" FontAttributes="Bold" TextDecorations="Underline" Grid.Column="2" Grid.Row="0" />
                            <Grid Grid.Column="3" ColumnDefinitions="*,*">
                                <Label Grid.Column="0" Text="Cost" FontAttributes="Bold" TextDecorations="Underline" TextColor="Red"/>
                                <Label Grid.Column="1" Text="Sale" FontAttributes="Bold" TextDecorations="Underline" TextColor="Orange"/>
                            </Grid>
                            <Grid Grid.Column="3" Grid.Row="2" ColumnDefinitions="*,*">
                                <Label Grid.Column="0" Text="{Binding JourneymanCostTotal, StringFormat='${0:F2}'}" TextColor="Red"/>
                                <Label Grid.Column="1" Text="{Binding JourneymanSaleTotal, StringFormat='${0:F2}'}" TextColor="Orange"/>
                            </Grid>
                            <Grid Grid.Column="3" Grid.Row="3" ColumnDefinitions="*,*">
                                <Label Grid.Column="0" Text="{Binding ApprenticeCostTotal, StringFormat='${0:F2}'}" TextColor="Red"/>
                                <Label Grid.Column="1" Text="{Binding ApprenticeSaleTotal, StringFormat='${0:F2}'}" TextColor="Orange"/>
                            </Grid>
                            <Grid Grid.Column="3" Grid.Row="5" ColumnDefinitions="*,*">
                                <Label Grid.Column="0" Text="{Binding TotalLaborCost, StringFormat='${0:F2}'}" FontAttributes="Bold" TextColor="Red"/>
                                <Label Grid.Column="1" Text="{Binding TotalLaborSale, StringFormat='${0:F2}'}" FontAttributes="Bold" TextColor="Orange"/>
                            </Grid>
                            <Label Text="Journeyman:" Grid.Column="0" Grid.Row="2" />
                            <Label Text="Apprentice:" Grid.Column="0" Grid.Row="3" />                            
                            <Label Text="{Binding JourneymanRegularHoursTotal}" Grid.Column="1" Grid.Row="2" />
                            <Label Text="{Binding ApprenticeRegularHoursTotal}" Grid.Column="1" Grid.Row="3" />
                            <Label Text="{Binding JourneymanOvernightHoursTotal}" Grid.Column="2" Grid.Row="2" />
                            <Label Text="{Binding ApprenticeOvernightHoursTotal}" Grid.Column="2" Grid.Row="3" />
                            <Label Text="Totals:" FontAttributes="Bold" Grid.Column="0" Grid.Row="5" />
                            <Label Text="{Binding TotalRegularHours, StringFormat='{0:F2}'}" FontAttributes="Bold" Grid.Column="1" Grid.Row="5" />
                            <Label Text="{Binding TotalOvernightHours, StringFormat='{0:F2}'}" FontAttributes="Bold" Grid.Column="2" Grid.Row="5"/>
                            <BoxView Grid.Row="4"
             Grid.ColumnSpan="5"
             HeightRequest="1"
             BackgroundColor="Gray"
             HorizontalOptions="Fill" />

                        </Grid>
                    </Border>
                </VerticalStackLayout>
            </Border>


            <!-- ============================= -->
            <!--         MATERIALS SECTION     -->
            <!-- ============================= -->
            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="20">
                    <!-- Header -->
                    <Label Text="Material Section" 
                           TextDecorations="Underline" 
                           FontAttributes="Bold,Italic" 
                           FontSize="18" 
                           TextColor="White" />
                    <StackLayout Orientation="Horizontal" Grid.Column="3" Spacing="5">
                        <Label Text="Markup %" />
                        <Entry Text="{Binding MaterialMarkup}" WidthRequest="60" Keyboard="Numeric" />
                    </StackLayout>

                    <!-- === PANEL COMPONENTS === -->
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Grid>
                            <Label Text="Panel Components" TextDecorations="Underline" HorizontalOptions="Start" FontAttributes="Bold" FontSize="18" TextColor="Red" />
                            </Grid>


                            <!-- Headers -->
                            <Grid ColumnDefinitions="2*,2*,*,*,*,*,2*,2*,*" ColumnSpacing="10">
                                <Label Text="Item" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="0" />
                                <Label Text="Description" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="1" />
                                <Label Text="Qty" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="2" />
                                <Label Text="Unit Cost" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="3" />
                                <Label Text="Unit Sale" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="4" />
                                <Label Text="Piped" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="5" />
                                <Label Text="Install Type" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="6" />
                                <Label Text="Install Location" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="7" />
                                <Label Text="Delete" HorizontalOptions="Center" FontAttributes="Bold" Grid.Column="8" />
                            </Grid>

                            <!-- Scrollable list -->
                            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                                <CollectionView  x:Name="BidComponentList"   
                              ItemsSource="{Binding ComponentLineItems}"
                              Margin="0,10"
                              HeightRequest="{Binding ComponentListHeight}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="2*,2*,*,*,*,*,2*,2*,*">
                                                <controls:SearchableEntryView
                                     Suggestions="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AvailableItems}"  
                                     SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                                     SearchText="{Binding Name, Mode=TwoWay}"
                                     DisplayMemberPath="Name"
                                     Placeholder="Search for an item..." >
                                                    <controls:SearchableEntryView.ItemTemplate>
                                                        <DataTemplate>
                                                            <Label Text="{Binding Name}" TextColor="Blue" Padding="10"/>
                                                        </DataTemplate>
                                                    </controls:SearchableEntryView.ItemTemplate>
                                                </controls:SearchableEntryView>
                                                <Entry Grid.Column="1" Text="{Binding Description, Mode=TwoWay, UpdateSourceEventName=TextChanged}" />
                                                <Entry Grid.Column="2" Text="{Binding Qty, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                    Keyboard="Numeric"
                                    Placeholder="1"/>

                                                <Grid Grid.Column="3" VerticalOptions="Center">
                                                    <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                    <Entry Grid.Column="0" Text="{Binding UnitCost, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0.00" />

                                                </Grid>

                                                <Grid Grid.Column="4" VerticalOptions="Center">
                                                    <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                    <Entry Text="{Binding UnitSale, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0.00" >
                                                        <Entry.Triggers>
                                                            <DataTrigger TargetType="Entry" Binding="{Binding IsSaleOverridden}" Value="True">
                                                                <Setter Property="BackgroundColor" Value="orange"/>
                                                                <Setter Property="TextColor" Value="black"/>
                                                            </DataTrigger>
                                                        </Entry.Triggers>
                                                    </Entry>
                                                </Grid>
                                                <CheckBox Grid.Column="5" HorizontalOptions="Center" IsChecked="{Binding Piped}" />
                                                <Picker Grid.Column="6" ItemsSource="{Binding InstallTypeOptions}" SelectedItem="{Binding InstallType}" />
                                                <Picker Grid.Column="7" ItemsSource="{Binding InstallLocationOptions}" SelectedItem="{Binding InstallLocation}" />
                                                <Button Grid.Column="8" 
                                         Text="❌"
                                         Command="{Binding BindingContext.RemoveComponentItemCommand, Source={x:Reference CreateBid}}"
                                         CommandParameter="{Binding .}"
                                         WidthRequest="40"
                                         HeightRequest="40"
                                         BackgroundColor="SlateBlue"
                                         CornerRadius="8"
                                         Padding="0"/>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>

                                </CollectionView>
                            </Border>

                            <!-- Buttons -->

                            <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                                <Button Grid.Column="0" Text="➕ Add Item" Command="{Binding AddComponentItemCommand}" BackgroundColor="MediumPurple" TextColor="White" />
                                <Button Grid.Column="1" Text="Create Item" Command="{Binding NavigateToCreateItemsCommand}" BackgroundColor="Orange" TextColor="White" />
                                <Button Grid.Column="2"  Text="{Binding ComponentExpandButtonText}"
                                        Command="{Binding ToggleComponentExpandCommand}" />
                            </Grid>

                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Cost" FontAttributes="Bold" TextColor="Red" Grid.Column="1" />
                                <Label Text="Sale" FontAttributes="Bold" TextColor="Orange" Grid.Column="2" />
                            </Grid>

                            <!-- Totals -->
                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Panel Totals:" FontAttributes="Bold" Grid.Column="0" />



                                <!-- Cost total -->
                                <Label Grid.Column="1"
                    Text="{Binding Source={x:Reference CreateBid}, Path=BindingContext.PanelLineItemsCostTotal, StringFormat='${0:F2}'}"
                    TextColor="Red"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Start" />

                                <!-- Sale total -->
                                <Label Grid.Column="2"
                    Text="{Binding PanelLineItemsSaleTotal, StringFormat='${0:F2}'}"
                    TextColor="Orange"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Start" />
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- === WIRE SUBSECTION === -->
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Grid>
                            <Label Text="Wire" TextDecorations="Underline" HorizontalOptions="Start" FontAttributes="Bold" FontSize="18" TextColor="Red" />
                            </Grid>

                            <!-- Headers -->
                            <Grid ColumnDefinitions="2*,3*,*,*,*,*" ColumnSpacing="10">
                                <Label Text="Item" Grid.Column="0" FontAttributes="Bold" />
                                <Label Text="Description" Grid.Column="1" FontAttributes="Bold" />
                                <Label Text="Qty" Grid.Column="2" FontAttributes="Bold" />
                                <Label Text="Unit Cost" Grid.Column="3" FontAttributes="Bold" />
                                <Label Text="Unit Sale" Grid.Column="4" FontAttributes="Bold" />
                                <Label Text="Delete" Grid.Column="5" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                            </Grid>

                            <!-- Scrollable list of items -->
                            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                                <CollectionView x:Name="BidWireList"
                                                ItemsSource="{Binding WireLineItems}"
                                                Margin="0,10"
                                                HeightRequest="{Binding WireListHeight}">
                                    <CollectionView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid ColumnDefinitions="2*,3*,*,*,*,*">
                                                <controls:SearchableEntryView
                                                        Suggestions="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AvailableItems}"
                                                        SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                                                        SearchText="{Binding Name, Mode=TwoWay}"
                                                        DisplayMemberPath="Name"
                                                        Placeholder="Search for an item..."/>

                                                <Entry  Grid.Column="1" Text="{Binding Description, Mode=TwoWay, UpdateSourceEventName=TextChanged}" Placeholder="Description"/>
                                                    
                                                    <Entry  Grid.Column="2" Text="{Binding Qty, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                                        Keyboard="Numeric"
                                                        Placeholder="1"/>

                                                    <Grid Grid.Column="3" VerticalOptions="Center">
                                                        <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                    <Entry Grid.Column="0" Text="{Binding UnitCost, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                                           Keyboard="Numeric" 
                                                           Placeholder="0.00" />
                                                    </Grid>

                                                    <Grid Grid.Column="4" VerticalOptions="Center">
                                                        <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                        <Entry Text="{Binding UnitSale, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                                               Keyboard="Numeric" 
                                                               Placeholder="0.00" >
                                                            <Entry.Triggers>
                                                                <DataTrigger TargetType="Entry" Binding="{Binding IsSaleOverridden}" Value="True">
                                                                    <Setter Property="BackgroundColor" Value="orange"/>
                                                                    <Setter Property="TextColor" Value="black"/>
                                                                </DataTrigger>
                                                            </Entry.Triggers>
                                                        </Entry>
                                                    </Grid>

                                                    <Button Grid.Column="5" Text="❌"
                                                            Command="{Binding BindingContext.RemoveWireItemCommand, Source={x:Reference CreateBid}}"
                                                            CommandParameter="{Binding .}"
                                                            WidthRequest="40"
                                                            HeightRequest="40"
                                                            BackgroundColor="SlateBlue"
                                                            CornerRadius="8"
                                                            Padding="0"/>
                                                </Grid>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                </CollectionView>
                            </Border>
                            
                            <!-- Buttons -->

                            <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                                <Button Grid.Column="0" Text="➕ Add Item" Command="{Binding AddWireItemCommand}" BackgroundColor="MediumPurple" TextColor="White" />
                                <Button Grid.Column="1" Text="Create Item" Command="{Binding NavigateToCreateItemsCommand}" BackgroundColor="Orange" TextColor="White" />
                                <Button Grid.Column="2"  Text="{Binding WireExpandButtonText}"
                                        Command="{Binding ToggleWireExpandCommand}" />
                            </Grid>

                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Cost" FontAttributes="Bold" TextColor="Red" Grid.Column="1" />
                                <Label Text="Sale" FontAttributes="Bold" TextColor="Orange" Grid.Column="2" />
                            </Grid>

                            <!-- Totals -->
                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Wire Totals:" FontAttributes="Bold" Grid.Column="0" />

                                <!-- Cost total -->
                                <Label Grid.Column="1"
                                       Text="{Binding Source={x:Reference CreateBid}, Path=BindingContext.WireLineItemsCostTotal, StringFormat='${0:F2}'}"
                                       TextColor="Red"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Start" />

                                <!-- Sale total -->
                                <Label Grid.Column="2"
                                       Text="{Binding WireLineItemsSaleTotal, StringFormat='${0:F2}'}"
                                       TextColor="Orange"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Start" />
                            </Grid> 
                        </VerticalStackLayout>
                    </Border>                   

                    <!-- === GENERAL MATERIALS === -->
                    <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Grid>
                                <Label Text="Materials" TextDecorations="Underline" HorizontalOptions="Start" FontAttributes="Bold" FontSize="18" TextColor="Red" />
                            </Grid>

                            <!-- Headers -->
                            <Grid ColumnDefinitions="2*,3*,*,*,*,*" ColumnSpacing="10">
                                <Label Text="Item" Grid.Column="0" FontAttributes="Bold" />
                                <Label Text="Description" Grid.Column="1" FontAttributes="Bold" />
                                <Label Text="Qty" Grid.Column="2" FontAttributes="Bold" />
                                <Label Text="Unit Cost" Grid.Column="3" FontAttributes="Bold" />
                                <Label Text="Unit Sale" Grid.Column="4" FontAttributes="Bold" />
                                <Label Text="Delete" Grid.Column="5" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                            </Grid>

                            <!-- Scrollable list of items -->
                            <Border Stroke="White" BackgroundColor="Black" StrokeThickness="1" Padding="10">
                                <CollectionView x:Name="MaterialWireList"
                            ItemsSource="{Binding MaterialLineItems}"
                            Margin="0,10"
                            HeightRequest="{Binding MaterialListHeight}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="2*,3*,*,*,*,*">
                                                <controls:SearchableEntryView
                                    Suggestions="{Binding Source={x:Reference CreateBid}, Path=BindingContext.AvailableItems}"
                                    SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                                    SearchText="{Binding Name, Mode=TwoWay}"
                                    DisplayMemberPath="Name"
                                    Placeholder="Search for an item..."/>

                                                <Entry  Grid.Column="1" Text="{Binding Description, Mode=TwoWay, UpdateSourceEventName=TextChanged}" Placeholder="Description"/>

                                                <Entry  Grid.Column="2" Text="{Binding Qty, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                    Keyboard="Numeric"
                                    Placeholder="1"/>

                                                <Grid Grid.Column="3" VerticalOptions="Center">
                                                    <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                    <Entry Grid.Column="0" Text="{Binding UnitCost, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                       Keyboard="Numeric" 
                                       Placeholder="0.00" />
                                                </Grid>

                                                <Grid Grid.Column="4" VerticalOptions="Center">
                                                    <Label Text="$" TextColor="White" VerticalOptions="Center" />
                                                    <Entry Text="{Binding UnitSale, Mode=TwoWay, Converter={StaticResource DecimalConverter}, UpdateSourceEventName=TextChanged}" 
                                           Keyboard="Numeric" 
                                           Placeholder="0.00" >
                                                        <Entry.Triggers>
                                                            <DataTrigger TargetType="Entry" Binding="{Binding IsSaleOverridden}" Value="True">
                                                                <Setter Property="BackgroundColor" Value="orange"/>
                                                                <Setter Property="TextColor" Value="black"/>
                                                            </DataTrigger>
                                                        </Entry.Triggers>
                                                    </Entry>
                                                </Grid>

                                                <Button Grid.Column="5" Text="❌"
                                        Command="{Binding BindingContext.RemoveMaterialItemCommand, Source={x:Reference CreateBid}}"
                                        CommandParameter="{Binding .}"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        BackgroundColor="SlateBlue"
                                        CornerRadius="8"
                                        Padding="0"/>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </Border>

                            <!-- Buttons -->

                            <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                                <Button Grid.Column="0" Text="➕ Add Item" Command="{Binding AddMaterialItemCommand}" BackgroundColor="MediumPurple" TextColor="White" />
                                <Button Grid.Column="1" Text="Create Item" Command="{Binding NavigateToCreateItemsCommand}" BackgroundColor="Orange" TextColor="White" />
                                <Button Grid.Column="2"  Text="{Binding MaterialExpandButtonText}"
                                        Command="{Binding ToggleMaterialExpandCommand}" />

                            </Grid>

                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Cost" FontAttributes="Bold" TextColor="Red" Grid.Column="1" />
                                <Label Text="Sale" FontAttributes="Bold" TextColor="Orange" Grid.Column="2" />
                            </Grid>

                            <!-- Totals -->
                            <Grid ColumnDefinitions="4*,*,*" Padding="0,10,0,0">
                                <Label Text="Materials Totals:" FontAttributes="Bold" Grid.Column="0" />

                                <!-- Cost total -->
                                <Label Grid.Column="1"
                                       Text="{Binding Source={x:Reference CreateBid}, Path=BindingContext.MaterialLineItemsCostTotal, StringFormat='${0:F2}'}"
                                       TextColor="Red"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Start" />

                                <!-- Sale total -->
                                <Label Grid.Column="2"
                                       Text="{Binding MaterialLineItemsSaleTotal, StringFormat='${0:F2}'}"
                                       TextColor="Orange"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Start" />
                            </Grid>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>